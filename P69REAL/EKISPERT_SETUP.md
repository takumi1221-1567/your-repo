# 🚃 駅すぱあと API 設定ガイド

## 📝 .env ファイルへの記載方法

駅すぱあとAPIには**2つのアクセスキー**があります。それぞれ別々に設定してください。

---

## ✅ 設定する2つのアクセスキー

### 1️⃣ 駅すぱあと API フリープラン環境のアクセスキー

**用途：** ルート検索、運賃計算など

**環境変数名：**
```
EKISPERT_API_KEY
```

**記載例：**
```env
EKISPERT_API_KEY=ここに駅すぱあとAPIのアクセスキーを記載
```

---

### 2️⃣ 駅すぱあと路線図 フリープラン環境のアクセスキー

**用途：** 路線図の表示

**環境変数名：**
```
EKISPERT_ROUTE_MAP_KEY
```

**記載例：**
```env
EKISPERT_ROUTE_MAP_KEY=ここに駅すぱあと路線図のアクセスキーを記載
```

---

## 📋 .env ファイルの記載方法

### 手順1: .env ファイルを開く

```bash
# Mac/Linux
nano .env

# または
code .env  # VS Code の場合
```

---

### 手順2: 以下のように記載

```env
# -----------------------------------------------
# 駅すぱあと API（ルート検索）
# -----------------------------------------------

# 駅すぱあと API フリープラン環境のアクセスキー
EKISPERT_API_KEY=ここに1つ目のアクセスキーを貼り付け

# 駅すぱあと路線図 フリープラン環境のアクセスキー
EKISPERT_ROUTE_MAP_KEY=ここに2つ目のアクセスキーを貼り付け
```

---

## ✅ 実際の記載例

取得したアクセスキーが以下の場合：

- **駅すぱあと API**: `abc123def456ghi789`
- **駅すぱあと路線図**: `xyz987wvu654tsr321`

**.env ファイルへの記載：**

```env
EKISPERT_API_KEY=abc123def456ghi789
EKISPERT_ROUTE_MAP_KEY=xyz987wvu654tsr321
```

⚠️ **注意：** `=` の前後にスペースは入れないでください

---

## 🔍 アクセスキーの確認方法

### 駅すぱあとWebサービスの管理画面で確認

1. https://ekispert.com/ にログイン
2. マイページを開く
3. 「フリープラン」のセクションを確認
4. 以下の2つが表示されているはず：
   - **駅すぱあと API フリープラン環境** → `EKISPERT_API_KEY` に設定
   - **駅すぱあと路線図 フリープラン環境** → `EKISPERT_ROUTE_MAP_KEY` に設定

---

## 🚀 Renderでの設定方法

Renderにデプロイする場合は、Environment Variables（環境変数）に以下の2つを追加してください。

### 追加する環境変数

#### 1つ目
```
キー: EKISPERT_API_KEY
値: （駅すぱあと API フリープラン環境のアクセスキー）
```

#### 2つ目
```
キー: EKISPERT_ROUTE_MAP_KEY
値: （駅すぱあと路線図 フリープラン環境のアクセスキー）
```

---

## ❌ よくある間違い

### 間違い1: キー名が違う

```env
# ❌ 間違い
ekispert_api_key=abc123  # 小文字
EkispertApiKey=abc123    # キャメルケース

# ✅ 正しい
EKISPERT_API_KEY=abc123  # 全て大文字
```

---

### 間違い2: 2つのキーを同じにしてしまう

```env
# ❌ 間違い（同じアクセスキーを2つに使用）
EKISPERT_API_KEY=abc123
EKISPERT_ROUTE_MAP_KEY=abc123  # ← これは間違い！

# ✅ 正しい（それぞれ別のアクセスキー）
EKISPERT_API_KEY=abc123
EKISPERT_ROUTE_MAP_KEY=xyz987  # ← 別のアクセスキー
```

---

### 間違い3: = の前後にスペースを入れる

```env
# ❌ 間違い
EKISPERT_API_KEY = abc123     # スペースあり
EKISPERT_API_KEY= abc123      # 値の前にスペース

# ✅ 正しい
EKISPERT_API_KEY=abc123       # スペースなし
```

---

### 間違い4: クォーテーションで囲む

```env
# ❌ 間違い
EKISPERT_API_KEY="abc123"     # クォーテーション不要
EKISPERT_API_KEY='abc123'     # クォーテーション不要

# ✅ 正しい
EKISPERT_API_KEY=abc123       # そのまま
```

---

## ✅ 設定完了の確認方法

### ローカル環境で確認

```bash
# サーバーを起動
npm start

# 別のターミナルで確認
curl http://localhost:3000/api/health
```

エラーがなければ設定完了です。

---

### Render環境で確認

1. Renderダッシュボードを開く
2. Environment タブを確認
3. 以下の2つが設定されているか確認：
   - `EKISPERT_API_KEY`
   - `EKISPERT_ROUTE_MAP_KEY`

---

## 📊 環境変数一覧（駅すぱあと関連）

| 環境変数名 | 説明 | 必須 |
|-----------|------|------|
| `EKISPERT_API_KEY` | 駅すぱあと API フリープラン環境のアクセスキー | ルート検索を使う場合は必須 |
| `EKISPERT_ROUTE_MAP_KEY` | 駅すぱあと路線図 フリープラン環境のアクセスキー | 路線図を使う場合は必須 |

---

## 🆘 トラブルシューティング

### エラー: `EKISPERT_API_KEY が設定されていません`

**原因：** 環境変数が設定されていない

**解決方法：**
1. `.env` ファイルに `EKISPERT_API_KEY=...` を追加
2. サーバーを再起動

---

### エラー: アクセスキーが無効

**原因：** アクセスキーが間違っている、または期限切れ

**解決方法：**
1. 駅すぱあとWebサービスの管理画面でアクセスキーを再確認
2. 正しいアクセスキーをコピー＆ペースト
3. サーバーを再起動

---

### エラー: 路線図が表示されない

**原因：** `EKISPERT_ROUTE_MAP_KEY` が設定されていない

**解決方法：**
1. `.env` ファイルに `EKISPERT_ROUTE_MAP_KEY=...` を追加
2. 駅すぱあと路線図用のアクセスキーを設定
3. サーバーを再起動

---

## 📖 参考リンク

- 駅すぱあとWebサービス公式: https://ekispert.com/
- APIドキュメント: https://docs.ekispert.com/

---

**🎉 これで駅すぱあとAPIの設定は完了です！**

わからないことがあれば、`ENV_SETUP_GUIDE.md` も確認してください。
